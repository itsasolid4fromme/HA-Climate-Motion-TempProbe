alias: HVAC - Outdoor Temp + Motion (Comfort/Eco with Resume)
id: hvac_outdoor_motion_comfort_eco_resume
mode: single
max_exceeded: silent

# --- TRIGGERS ---
trigger:
  # Outdoor drives the mode & initial occupied setpoints
  - id: heat_temp
    platform: numeric_state
    entity_id: sensor.thermo_hygrometer_20be08_h5074_tempc
    below: 60.0

  - id: cool_temp
    platform: numeric_state
    entity_id: sensor.thermo_hygrometer_20be08_h5074_tempc
    above: 71.0

  # Motion handling
  - id: no_motion_10m
    platform: state
    entity_id: binary_sensor.camper_eye_camper_motion
    to: "off"
    for: "00:10:00"

  - id: motion_on
    platform: state
    entity_id: binary_sensor.camper_eye_camper_motion
    to: "on"

# --- ACTIONS ---
action:
  - choose:
      # 1) Outdoor below 60°F → HEAT @ 67°F (occupied)
      - conditions:
          - condition: trigger
            id: heat_temp
        sequence:
          - service: climate.set_hvac_mode
            target:
              entity_id: climate.air_conditioner_fae455_air_conditioner
            data:
              hvac_mode: heat
          - service: climate.set_temperature
            target:
              entity_id: climate.air_conditioner_fae455_air_conditioner
            data:
              temperature: 67

      # 2) Outdoor ≥ 71°F → COOL @ 74°F (occupied)
      - conditions:
          - condition: trigger
            id: cool_temp
        sequence:
          - service: climate.set_hvac_mode
            target:
              entity_id: climate.air_conditioner_fae455_air_conditioner
            data:
              hvac_mode: cool
          - service: climate.set_temperature
            target:
              entity_id: climate.air_conditioner_fae455_air_conditioner
            data:
              temperature: 74

      # 3) No motion for 10 minutes → ECO temp for current mode only
      - conditions:
          - condition: trigger
            id: no_motion_10m
        sequence:
          # If currently in HEAT, go to 61°F
          - if:
              - condition: state
                entity_id: climate.air_conditioner_fae455_air_conditioner
                state: heat
            then:
              - service: climate.set_temperature
                target:
                  entity_id: climate.air_conditioner_fae455_air_conditioner
                data:
                  temperature: 61
            else:
              # If currently in COOL, go to 77°F
              - if:
                  - condition: state
                    entity_id: climate.air_conditioner_fae455_air_conditioner
                    state: cool
                then:
                  - service: climate.set_temperature
                    target:
                      entity_id: climate.air_conditioner_fae455_air_conditioner
                    data:
                      temperature: 77
                else:
                  # If HVAC is off/auto/other, do nothing.
                  - stop: "HVAC not in heat/cool; no eco change."

      # 4) Motion turns ON → resume occupied temps based on outdoor temp
      - conditions:
          - condition: trigger
            id: motion_on
        sequence:
          # If it's a HEAT day (outdoor < 60°F), force HEAT 67°F
          - if:
              - condition: numeric_state
                entity_id: sensor.thermo_hygrometer_20be08_h5074_tempc
                below: 60.0
            then:
              - service: climate.set_hvac_mode
                target:
                  entity_id: climate.air_conditioner_fae455_air_conditioner
                data:
                  hvac_mode: heat
              - service: climate.set_temperature
                target:
                  entity_id: climate.air_conditioner_fae455_air_conditioner
                data:
                  temperature: 67

            else:
              # If it's a COOL day (outdoor ≥ 71°F), force COOL 74°F
              - if:
                  - condition: numeric_state
                    entity_id: sensor.thermo_hygrometer_20be08_h5074_tempc
                    above: 71.0
                then:
                  - service: climate.set_hvac_mode
                    target:
                      entity_id: climate.air_conditioner_fae455_air_conditioner
                    data:
                      hvac_mode: cool
                  - service: climate.set_temperature
                    target:
                      entity_id: climate.air_conditioner_fae455_air_conditioner
                    data:
                      temperature: 74
                else:
                  # Between 60°F and 71°F → do nothing on motion resume
                  - stop: "Outdoor between 60–71°F; no occupied-setpoint change."
