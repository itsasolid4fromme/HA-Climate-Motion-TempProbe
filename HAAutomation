alias: HVAC - Motion + Outdoor Temp Control Camper
description: ""
triggers:
  - entity_id: binary_sensor.camper_motion
    to: "on"
    trigger: state
  - entity_id: binary_sensor.camper_motion
    to: "off"
    for: "00:10:00"
    trigger: state
  - entity_id:
      - sensor.thermo_hygrometer_20be08_h5074_tempc
    below: 59.5
    for:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
    trigger: numeric_state
  - entity_id:
      - sensor.thermo_hygrometer_20be08_h5074_tempc
    above: 71.5
    for:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
    trigger: numeric_state
actions:
  - variables:
      t: "{{ states(outdoor_sensor) | float(999) }}"
      occupied: "{{ is_state('binary_sensor.camper_motion','on') }}"
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ t < heat_threshold_f }}"
        sequence:
          - target:
              entity_id: climate.air_conditioner_fae455_air_conditioner
            data:
              hvac_mode: heat
            action: climate.set_hvac_mode
          - target:
              entity_id: climate.air_conditioner_fae455_air_conditioner
            data:
              temperature: >
                {% if occupied %}{{ heat_comfort }}{% else %}{{ heat_eco }}{%
                endif %}
            action: climate.set_temperature
      - conditions:
          - condition: template
            value_template: "{{ t >= cool_threshold_f }}"
        sequence:
          - target:
              entity_id: climate.air_conditioner_fae455_air_conditioner
            data:
              hvac_mode: cool
            action: climate.set_hvac_mode
          - target:
              entity_id: climate.air_conditioner_fae455_air_conditioner
            data:
              temperature: >
                {% if occupied %}{{ cool_comfort }}{% else %}{{ cool_eco }}{%
                endif %}
            action: climate.set_temperature
    default: []
mode: restart
variables:
  outdoor_sensor: H5075-tempc
  heat_threshold_f: 60
  cool_threshold_f: 71
  heat_comfort: 67
  heat_eco: 61
  cool_comfort: 74
  cool_eco: 77
